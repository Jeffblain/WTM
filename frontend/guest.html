<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wine Tasting Selection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #8B0000, #A52A2A);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .guest-names {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .guest-name-input {
            display: flex;
            flex-direction: column;
        }
        
        .guest-name-input label {
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: #666;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .guest-counter {
            font-size: 0.8rem;
            font-weight: bold;
            color: #fff;
            background: #dc3545;
            border-radius: 12px;
            padding: 3px 8px;
            min-width: 35px;
            text-align: center;
        }
        
        .guest-counter.complete {
            background: #28a745;
        }
        
        .guest-name-input input {
            padding: 8px 12px;
            font-size: 0.9rem;
        }
        
        .plateau-section {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
        }
        
        .plateau-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #856404;
            margin-bottom: 15px;
        }
        
        .plateau-selector {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .quantity-input {
            width: 80px;
            padding: 10px;
            font-size: 1.2rem;
            text-align: center;
            border: 2px solid #ffc107;
            border-radius: 8px;
        }
        
        .wine-grid {
            display: grid;
            grid-template-columns: 2fr repeat(4, 1fr);
            gap: 15px;
            margin-top: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        
        .wine-header, .guest-header {
            font-weight: 700;
            color: #8B0000;
            padding: 15px 10px;
            background: white;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .wine-item {
            font-weight: 600;
            padding: 12px 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #8B0000;
        }
        
        .wine-name {
            font-size: 1rem;
            color: #333;
            margin-bottom: 5px;
        }
        
        .wine-description {
            font-size: 0.8rem;
            color: #666;
            font-weight: 400;
            font-style: italic;
        }
        
        .wine-checkbox {
            text-align: center;
            padding: 10px;
        }
        
        .wine-checkbox input {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .warning-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
            margin: 20px 0;
            display: none;
        }
        
        .warning-message.show {
            display: block;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .submit-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #c3e6cb;
            margin-top: 20px;
            text-align: center;
            display: none;
        }
        
        .success-message.show {
            display: block;
        }
        
        @media (max-width: 768px) {
            .wine-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .guest-header {
                display: none;
            }
            
            .wine-checkbox {
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: white;
                border-radius: 8px;
                margin-bottom: 10px;
            }
            
            .guest-names {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üç∑ Vignoble le Chat Bott√© - D√©gustation</h1>
            <p>S√©lectionnez votre parfaite exp√©rience</p>
        </div>
        
        <div class="content">
            <div class="warning-message" id="validationWarning">
                <strong>‚ö†Ô∏è Attention:</strong>
                <div id="warningText">Chaque invit√© doit s√©lectionner exactement 4 vins.</div>
            </div>
            
            <div class="form-group">
                <label for="groupName">Nom du groupe (obligatoire)</label>
                <input type="text" id="groupName" placeholder="Entrez le nom de votre groupe..." required>
            </div>
            
            <div class="plateau-section">
                <div class="plateau-title">üßÄ Plateau de Fromages et Charcuteries</div>
                <div class="plateau-selector">
                    <label for="plateauCount">Nombre de plateaux:</label>
                    <input type="number" class="quantity-input" id="plateauCount" min="0" max="10" value="0">
                    <span>(25$ chaque)</span>
                </div>
            </div>
            
            <div class="guest-names">
                <div class="guest-name-input">
                    <label>
                        Invit√© 1 
                        <span class="guest-counter" id="counter1">0/4</span>
                    </label>
                    <input type="text" id="guest1Name" placeholder="Entrez votre pr√©nom...">
                </div>
                <div class="guest-name-input">
                    <label>
                        Invit√© 2 
                        <span class="guest-counter" id="counter2">0/4</span>
                    </label>
                    <input type="text" id="guest2Name" placeholder="Entrez votre pr√©nom...">
                </div>
                <div class="guest-name-input">
                    <label>
                        Invit√© 3 
                        <span class="guest-counter" id="counter3">0/4</span>
                    </label>
                    <input type="text" id="guest3Name" placeholder="Entrez votre pr√©nom...">
                </div>
                <div class="guest-name-input">
                    <label>
                        Invit√© 4 
                        <span class="guest-counter" id="counter4">0/4</span>
                    </label>
                    <input type="text" id="guest4Name" placeholder="Entrez votre pr√©nom...">
                </div>
            </div>
            
            <div class="wine-grid">
                <div class="wine-header">S√©lection de vins - Cidres</div>
                <div class="guest-header">Invit√© 1</div>
                <div class="guest-header">Invit√© 2</div>
                <div class="guest-header">Invit√© 3</div>
                <div class="guest-header">Invit√© 4</div>
                
                <div class="wine-item">
                    <div class="wine-name">Ze Flying Pig - Cidre</div>
                    <div class="wine-description">Cidre brut mousseux issu de nos pommes McIntosh. √âlev√© sur les marcs de nos raisins rouges.</div>
                </div>
                <div class="wine-checkbox"><input type="checkbox" id="wine1-g1" onchange="updateCounter(1)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine1-g2" onchange="updateCounter(2)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine1-g3" onchange="updateCounter(3)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine1-g4" onchange="updateCounter(4)"></div>
                
                <div class="wine-item">
                    <div class="wine-name">Petnat Chardonnay - Bulles</div>
                    <div class="wine-description">P√©tillant naturel 100% Chardonnay, certifi√© biologique et produit selon la m√©thode ancestrale.</div>
                </div>
                <div class="wine-checkbox"><input type="checkbox" id="wine2-g1" onchange="updateCounter(1)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine2-g2" onchange="updateCounter(2)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine2-g3" onchange="updateCounter(3)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine2-g4" onchange="updateCounter(4)"></div>
                
                <div class="wine-item">
                    <div class="wine-name">Blanc - Bio</div>
                    <div class="wine-description">Vin √† la robe claire de reflets jaun√¢tres pr√©sentant un nez frais et min√©ral.</div>
                </div>
                <div class="wine-checkbox"><input type="checkbox" id="wine3-g1" onchange="updateCounter(1)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine3-g2" onchange="updateCounter(2)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine3-g3" onchange="updateCounter(3)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine3-g4" onchange="updateCounter(4)"></div>
                
                <div class="wine-item">
                    <div class="wine-name">Gris de Gris</div>
                    <div class="wine-description">Ros√© pr√©sentant des notes typiques de pamplemousse et de zeste d'agrumes.</div>
                </div>
                <div class="wine-checkbox"><input type="checkbox" id="wine4-g1" onchange="updateCounter(1)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine4-g2" onchange="updateCounter(2)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine4-g3" onchange="updateCounter(3)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine4-g4" onchange="updateCounter(4)"></div>
                
                <div class="wine-item">
                    <div class="wine-name">Ros√© Pamplemousse</div>
                    <div class="wine-description">Robe de couleur p√™che, nez pr√©sentant des ar√¥mes frais de pamplemousse rose.</div>
                </div>
                <div class="wine-checkbox"><input type="checkbox" id="wine5-g1" onchange="updateCounter(1)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine5-g2" onchange="updateCounter(2)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine5-g3" onchange="updateCounter(3)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine5-g4" onchange="updateCounter(4)"></div>
                
                <div class="wine-item">
                    <div class="wine-name">Premier Pas - Bio</div>
                    <div class="wine-description">Vin rouge ferment√© en grappes enti√®res. Foulage aux pieds selon une m√©thode traditionnelle.</div>
                </div>
                <div class="wine-checkbox"><input type="checkbox" id="wine6-g1" onchange="updateCounter(1)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine6-g2" onchange="updateCounter(2)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine6-g3" onchange="updateCounter(3)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine6-g4" onchange="updateCounter(4)"></div>
                
                <div class="wine-item">
                    <div class="wine-name">H√©lium</div>
                    <div class="wine-description">Chaleureux, √©quilibr√©, aromatique et souple. Notes de cerise ferment√©e et fruits des bois.</div>
                </div>
                <div class="wine-checkbox"><input type="checkbox" id="wine7-g1" onchange="updateCounter(1)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine7-g2" onchange="updateCounter(2)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine7-g3" onchange="updateCounter(3)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine7-g4" onchange="updateCounter(4)"></div>
                
                <div class="wine-item">
                    <div class="wine-name">Rouge Bourbon</div>
                    <div class="wine-description">Premier vin rouge √©lev√© en f√ªts de Bourbon au Qu√©bec. Ar√¥mes de caramel √©cossais et vanille.</div>
                </div>
                <div class="wine-checkbox"><input type="checkbox" id="wine8-g1" onchange="updateCounter(1)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine8-g2" onchange="updateCounter(2)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine8-g3" onchange="updateCounter(3)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine8-g4" onchange="updateCounter(4)"></div>
                
                <div class="wine-item">
                    <div class="wine-name">Rouge Cognac</div>
                    <div class="wine-description">Premier vin rouge √©lev√© en f√ªts de Cognac au Qu√©bec. Notes de cerise noire confite et √©pices.</div>
                </div>
                <div class="wine-checkbox"><input type="checkbox" id="wine9-g1" onchange="updateCounter(1)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine9-g2" onchange="updateCounter(2)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine9-g3" onchange="updateCounter(3)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine9-g4" onchange="updateCounter(4)"></div>
                
                <div class="wine-item">
                    <div class="wine-name">Le Chat Noir</div>
                    <div class="wine-description">Premier vin de paille fortifi√© au Qu√©bec. Rappelant un Porto Tawny avec ses ar√¥mes de fruits confits.</div>
                </div>
                <div class="wine-checkbox"><input type="checkbox" id="wine10-g1" onchange="updateCounter(1)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine10-g2" onchange="updateCounter(2)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine10-g3" onchange="updateCounter(3)"></div>
                <div class="wine-checkbox"><input type="checkbox" id="wine10-g4" onchange="updateCounter(4)"></div>
            </div>
            
            <div style="text-align: center;">
                <button class="submit-btn" id="submitBtn" onclick="submitOrder()">Soumettez votre s√©lection</button>
            </div>
            
            <div class="success-message" id="successMessage">
                <h3>‚úÖ Commande pass√©e avec succ√®s</h3>
                <p>Votre s√©lection a √©t√© transmise, veuillez svp vous pr√©senter au comptoir de la boutique pour votre premi√®re d√©gustation</p>
                <p><strong>Code de session:</strong> <span id="sessionCode"></span></p>
            </div>
        </div>
    </div>
    
    <script>
        // Server URL - change for production
        const API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:3001' 
            : 'https://wtm-production.up.railway.app';
        
        function updateCounter(guestNum) {
            const checkboxes = document.querySelectorAll(`input[id*="wine"][id*="-g${guestNum}"]`);
            const checked = Array.from(checkboxes).filter(cb => cb.checked).length;
            const counter = document.getElementById(`counter${guestNum}`);
            
            if (counter) {
                counter.textContent = `${checked}/4`;
                counter.className = 'guest-counter ' + (checked === 4 ? 'complete' : '');
            }
        }
        
        function validateSelections() {
            let allValid = true;
            let messages = [];
            
            for (let i = 1; i <= 4; i++) {
                const checkboxes = document.querySelectorAll(`input[id*="wine"][id*="-g${i}"]`);
                const checked = Array.from(checkboxes).filter(cb => cb.checked).length;
                
                if (checked !== 4) {
                    allValid = false;
                    const guestName = document.getElementById(`guest${i}Name`).value || `Invit√© ${i}`;
                    messages.push(`${guestName}: ${checked}/4 vins s√©lectionn√©s`);
                }
            }
            
            const warningDiv = document.getElementById('validationWarning');
            const warningText = document.getElementById('warningText');
            
            if (!allValid) {
                warningText.innerHTML = `
                    <strong>S√©lections incompl√®tes:</strong><br>
                    ${messages.join('<br>')}
                `;
                warningDiv.classList.add('show');
                return false;
            } else {
                warningDiv.classList.remove('show');
                return true;
            }
        }
        
        function getWineName(wineNum) {
            const wines = [
                "Ze Flying Pig - Cidre",
                "Petnat Chardonnay - Bulles", 
                "Blanc - Bio",
                "Gris de Gris",
                "Ros√© Pamplemousse",
                "Premier Pas - Bio",
                "H√©lium",
                "Rouge Bourbon",
                "Rouge Cognac",
                "Le Chat Noir"
            ];
            return wines[wineNum - 1] || `Vin ${wineNum}`;
        }
        
        async function submitOrder() {
            const groupName = document.getElementById('groupName').value.trim();
            if (!groupName) {
                alert('Veuillez entrer un nom de groupe');
                return;
            }
            
            if (!validateSelections()) {
                return;
            }
            
            const guestNames = {};
            for (let i = 1; i <= 4; i++) {
                const name = document.getElementById(`guest${i}Name`).value.trim();
                if (name) guestNames[`guest${i}`] = name;
            }
            
            const selections = {};
            for (let guest = 1; guest <= 4; guest++) {
                selections[`guest${guest}`] = [];
                for (let wine = 1; wine <= 10; wine++) {
                    const checkbox = document.getElementById(`wine${wine}-g${guest}`);
                    if (checkbox && checkbox.checked) {
                        selections[`guest${guest}`].push({
                            wine: getWineName(wine),
                            status: 'Non servi'
                        });
                    }
                }
            }
            
            const plateauCount = parseInt(document.getElementById('plateauCount').value) || 0;
            const plateauData = {
                count: plateauCount,
                total: plateauCount * 25
            };
            
            try {
                const API_URL = window.location.hostname === 'localhost' 
                    ? 'http://localhost:3001' 
                    : 'https://wtm-production.up.railway.app';
                
                const response = await fetch(`${API_URL}/api/orders`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        groupName,
                        guestNames,
                        selections,
                        plateauData
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('successMessage').classList.add('show');
                    document.querySelectorAll('input').forEach(input => input.disabled = true);
                    document.getElementById('submitBtn').disabled = true;
                } else {
                    alert('Erreur: ' + (result.error || '√âchec de la soumission'));
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur de connexion au serveur');
            }
        }
        
        window.addEventListener('load', function() {
            for (let i = 1; i <= 4; i++) {
                updateCounter(i);
            }
        });
    </script>
</body>
</html>